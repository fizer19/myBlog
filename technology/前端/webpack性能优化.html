<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack性能优化 | fizer的个人博客-分享技术记录生活</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/myBlog/favicon.ico">
    <meta name="description" content="webpack性能优化">
    <meta name="author" content="fizer">
    <meta name="keywords" content="vuepress 介绍，fizer的个人博客">
    
    <link rel="preload" href="/myBlog/assets/css/0.styles.d568e558.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.b01551eb.js" as="script"><link rel="preload" href="/myBlog/assets/js/3.33770070.js" as="script"><link rel="preload" href="/myBlog/assets/js/1.ef2f72d5.js" as="script"><link rel="preload" href="/myBlog/assets/js/26.691ba954.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.d62598e7.js"><link rel="prefetch" href="/myBlog/assets/js/11.a11f11e4.js"><link rel="prefetch" href="/myBlog/assets/js/12.4abc77a9.js"><link rel="prefetch" href="/myBlog/assets/js/13.2fb267eb.js"><link rel="prefetch" href="/myBlog/assets/js/14.08870612.js"><link rel="prefetch" href="/myBlog/assets/js/15.e2859422.js"><link rel="prefetch" href="/myBlog/assets/js/16.0d6f0144.js"><link rel="prefetch" href="/myBlog/assets/js/17.5714f9a6.js"><link rel="prefetch" href="/myBlog/assets/js/18.bab89c38.js"><link rel="prefetch" href="/myBlog/assets/js/19.f33b639b.js"><link rel="prefetch" href="/myBlog/assets/js/20.c74f7052.js"><link rel="prefetch" href="/myBlog/assets/js/21.0be5f80b.js"><link rel="prefetch" href="/myBlog/assets/js/22.20b1a26d.js"><link rel="prefetch" href="/myBlog/assets/js/23.265d1681.js"><link rel="prefetch" href="/myBlog/assets/js/24.e4783ac9.js"><link rel="prefetch" href="/myBlog/assets/js/25.a9c0d1d2.js"><link rel="prefetch" href="/myBlog/assets/js/27.fbb666bf.js"><link rel="prefetch" href="/myBlog/assets/js/28.420014ac.js"><link rel="prefetch" href="/myBlog/assets/js/29.bd4262bf.js"><link rel="prefetch" href="/myBlog/assets/js/30.66f733b6.js"><link rel="prefetch" href="/myBlog/assets/js/31.0a72c44d.js"><link rel="prefetch" href="/myBlog/assets/js/4.bead3ccb.js"><link rel="prefetch" href="/myBlog/assets/js/5.8892dfd1.js"><link rel="prefetch" href="/myBlog/assets/js/6.5fa08267.js"><link rel="prefetch" href="/myBlog/assets/js/7.7fbedbce.js"><link rel="prefetch" href="/myBlog/assets/js/8.886c04f0.js"><link rel="prefetch" href="/myBlog/assets/js/9.6cb0a32d.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.d568e558.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-934bcd86><header class="navbar" data-v-934bcd86><a href="/myBlog/" class="home-link router-link-active"><img src="/myBlog/assets/img/avatar.png" alt="fizer的个人博客-分享技术记录生活" class="logo"> <span class="site-name can-hide">fizer的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分享" class="mobile-dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/technology/fontend.html" class="nav-link">
  前端相关
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/javaScript.html" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tutorial/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/myBlog/essay/" class="nav-link">
  随笔
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-934bcd86></div> <aside class="sidebar" data-v-934bcd86><div class="sidebar_list"><div class="sidebar_title">前端</div> <div class="page_list active"><a href="/myBlog/technology/%E5%89%8D%E7%AB%AF/webpack%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" aria-current="page" class="article_item router-link-exact-active router-link-active">webpack性能优化</a></div><div class="page_list"><a href="/myBlog/technology/%E5%89%8D%E7%AB%AF/webpack%E6%89%93%E5%8C%85%E6%9B%B4%E5%A4%9A%E9%85%8D%E7%BD%AE.html" class="article_item">webpack更多配置</a></div><div class="page_list"><a href="/myBlog/technology/%E5%89%8D%E7%AB%AF/webpack%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE.html" class="article_item">webpack资源打包</a></div><div class="page_list"><a href="/myBlog/technology/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E8%A6%81%E6%8E%8C%E6%8F%A1%E5%93%AA%E4%BA%9B%E7%9F%A5%E8%AF%86.html" class="article_item">前端开发要掌握哪些知识？</a></div><div class="page_list"><a href="/myBlog/technology/%E5%89%8D%E7%AB%AF/Echarts%E6%A0%87%E7%AD%BE%E6%96%87%E5%AD%97%E8%BF%87%E9%95%BF.html" class="article_item">Echarts标签文字过长以及在app端formatter函数失效问题</a></div></div> <nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术分享" class="dropdown-title"><span class="title">技术分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术分享" class="mobile-dropdown-title"><span class="title">技术分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/technology/fontend.html" class="nav-link">
  前端相关
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/technology/javaScript.html" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tutorial/" class="nav-link">
  教程
</a></div><div class="nav-item"><a href="/myBlog/essay/" class="nav-link">
  随笔
</a></div> <!----></nav>  </aside> <main class="page" data-v-934bcd86> <div class="theme-default-content content__default"><h3 id="_1-source-map"><a href="#_1-source-map" class="header-anchor">#</a> 1. source-map</h3> <p>  一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射可以追踪源代码错误）</p> <p>只需要在<code>webpack.config.js</code>中配置即可</p> <div class="language-js extra-class"><pre class="language-js"><code>devtool<span class="token operator">:</span> <span class="token string">'source-map'</span>
</code></pre></div><p>source-map还可以带上前缀，表示不同的方式</p> <ul><li>inline-source-map: 内联，只生成一个内联source-map，错误代码的准确信息和源代码错误位置</li> <li>eval-source-map: 内联，每一个文件都生成对应的source-map，都在eval中，错误代码的准确信息和源代码错误位置</li> <li>hidden-source-map：外部，错误代码错误原因，但是只能定位到构建后代码错误的位置</li> <li>nosources-source-map：外部,错误代码的准确信息但是没有任何源代码，和hidden一样用于隐藏源代码</li> <li>cheap-source-map：外部,错误代码的准确信息和源代码错误位置，只能精确到行</li> <li>cheap-module-source-map: 外部，错误代码的准确信息和源代码错误位置，module会将loader的source-map加入</li></ul> <p>内联和外部区别： 外部生成了文件，内联没有，内联构建速度更快</p> <p>那么如何选择呢？</p> <p>开发环境需要速度快，调试更友好</p> <div class="language- extra-class"><pre><code>    速度快(eval&gt;inline&gt;cheap&gt;...) 
        eval-cheap-source-map
        eval-source-map
    调试更友好
        source-map
        cheap-module-source-map
        cheap-source-map
        推荐使用--&gt;eval-source-map(脚手架默认使用方式)
</code></pre></div><p>生产环境，源代码要不要隐藏，调试要不要更友好，内联会让代码体积变大，所以生产环境不用内联。</p> <div class="language- extra-class"><pre><code>    nosources-source-map 全部隐藏
    hidden-source-map 隐藏源代码，会提示构建后代码错误信息
    推荐使用--&gt; source-map / cheap-moudle-source-map
</code></pre></div><h3 id="_2-oneof-生产环境性能优化"><a href="#_2-oneof-生产环境性能优化" class="header-anchor">#</a> 2. oneOf （生产环境性能优化）</h3> <p>  每个文件在配置loader中只会匹配一个，比如css文件匹配到了.css 的loader就不会再匹配后面的loader。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    oneOf<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>commonCssLoader<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            use<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token operator">...</span>commonCssLoader<span class="token punctuation">,</span>
                <span class="token string">'less-loader'</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">//...</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre></div><blockquote><p>需要注意的是，不能有两个配置处理同一个类型文件，不会执行后面那个配置，所以需要单独提取到oneOf外部</p></blockquote> <p>当一个文件要被多个loader处理，一定要指定loader执行的顺序，先执行eslint再执行babel</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//语法校验</span>
<span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token comment">//优先执行</span>
    enforce<span class="token operator">:</span> <span class="token string">'pre'</span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
        fix<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_3-缓存"><a href="#_3-缓存" class="header-anchor">#</a> 3. 缓存</h3> <p>缓存有babel缓存和文件资源缓存。</p> <p>(1) babel缓存：在babel配置中 cacheDirectory: true</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//开启babel缓存，第二次构建时会读取之前的缓存</span>
cacheDirectory<span class="token operator">:</span> <span class="token boolean">true</span>
</code></pre></div><p>(2) 文件资源缓存：服务器对资源进行缓存处理，用户第二次访问速度会更快。</p> <p>  只对资源做缓存处理会带来一个问题，如果资源更新，用户访问到的还是之前的缓存。这是应为重新打包后文件名称没有变，所以加载的还是之前的缓存。所以得在输出文件的名字上做点手脚，文件名用上hash值。</p> <p><strong>hash：</strong> 每次webpack构建时会生成一个唯一的hash值</p> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'js/built.[hash:10].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'css/built.[hash:10].css'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><blockquote><p>问题：因为js和css同时使用一个hash值，所以重新打包会导致所有缓存失效（即使只改变了一个文件）</p></blockquote> <p><strong>chunkhash：</strong> 还有一个hash值，chunkhash，根据chunk生成的hash值，如果打包资源来自同一个chunk，hash值就一样。chunkhash也有问题：js和css的hash还是同一个，因为css是在js中引入的，同属于一个chunk。</p> <p><strong>contenthash：</strong> 根据文件的内容生成hash值，不同文件的hash值一定不一样，也就是说，哪个文件被修改了，该文件打包后输出的名字也会改变。</p> <div class="language-js extra-class"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'js/built.[contenthash:10].js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'build'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>最终的解决方案：contenthash。</p> <h3 id="_4-code-split-代码分割"><a href="#_4-code-split-代码分割" class="header-anchor">#</a> 4. code split 代码分割</h3> <p>  不同的文件，不做配置时可能会打包成一个chunk，导致请求文件体积太大，影响相应速度。所以需要将不同模块分割成单独的chunk，可以从一下方式入手：</p> <p>多入口</p> <div class="language-js extra-class"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//多入口: 一个入口对应输出一个bundle  一般应用于多页面应用</span>
    index<span class="token operator">:</span> <span class="token string">'./src/js/index.js'</span><span class="token punctuation">,</span><span class="token comment">//这里的值也可以是数组或对象，数组方式只会形成一个chunk</span>
    test<span class="token operator">:</span> <span class="token string">'./src/js/test.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>配置：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 
    1.可以将node_modules中引入的代码单独打包成一个chunk最终输出
    2. 多入口中，自动分析有没有公共文件，如果有会打包成一个单独的chunk
*/</span>
optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        chunks<span class="token operator">:</span> <span class="token string">'all'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>动态引入：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 
  通过js代码，让某个文件被单独打包成一个chunk
  import动态导入语法：能将某个文件单独打包
*/</span>
<span class="token comment">//webpackChunkName: 'test' 打包文件命名</span>
<span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'test' */</span><span class="token string">'./test'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>mul<span class="token punctuation">,</span>count<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//文件加载成功</span>
    <span class="token comment">// eslint-disable-next-line</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// eslint-disable-next-line</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件加载失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>动态引入很懒加载是一样的原理。</p> <ul><li>懒加载: 当文件需要用的时候才被加载</li> <li>预加载：<code>webpackPrefetch: true</code>会在使用之前，提前加载js文件，正常加载可以认为是并行加载，暂时不需要的也加载了，影响加载速度，而预加载则是等浏览器空闲了，再偷偷的加载资源</li></ul> <blockquote><p>预加载兼容性问题大，在移动端和ie有较大兼容性问题</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: 'test', webpackPrefetch: true */</span><span class="token string">'./test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>mul<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-externals"><a href="#_5-externals" class="header-anchor">#</a> 5. externals</h3> <p>  忽略通过cdn方式引入的库。</p> <div class="language-js extra-class"><pre class="language-js"><code>externals<span class="token operator">:</span> <span class="token punctuation">{</span>
 <span class="token comment">//忽略库名 --npm包名</span>
 <span class="token comment">//不打包jquery</span>
 jquery<span class="token operator">:</span> <span class="token string">'jQuery'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-多进程打包"><a href="#_6-多进程打包" class="header-anchor">#</a> 6. 多进程打包</h3> <p>包：<code>thread-loader</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
        workers<span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">//开启2个进程</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><blockquote><p>进程启动大概600ms，进程通信也有开销，只有工作消耗时间比较长，才需要多进程打包，不能滥用</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2021-03-12</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/myBlog/assets/js/app.b01551eb.js" defer></script><script src="/myBlog/assets/js/3.33770070.js" defer></script><script src="/myBlog/assets/js/1.ef2f72d5.js" defer></script><script src="/myBlog/assets/js/26.691ba954.js" defer></script>
  </body>
</html>
